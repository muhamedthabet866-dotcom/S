import streamlit as st
import pandas as pd
from docx import Document
import tempfile
import os

# Ø¥Ø¹Ø¯Ø§Ø¯ ØµÙØ­Ø© Streamlit
st.set_page_config(
    page_title="SPSS Syntax Generator",
    page_icon="ğŸ“Š",
    layout="wide"
)

# Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
st.title("ğŸ“Š Ù…ÙˆÙ„Ø¯ ÙƒÙˆØ¯ SPSS ØªÙ„Ù‚Ø§Ø¦ÙŠ")
st.markdown("### Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Excel ÙˆWord Ù„ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ SPSS Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…")

def read_excel_file(uploaded_file):
    """Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Excel"""
    try:
        # Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¤Ù‚Øª
        with tempfile.NamedTemporaryFile(delete=False, suffix='.xlsx') as tmp_file:
            tmp_file.write(uploaded_file.getvalue())
            tmp_path = tmp_file.name
        
        # Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        df = pd.read_excel(tmp_path)
        
        # ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¤Ù‚Øª
        os.unlink(tmp_path)
        
        return df, None
    except Exception as e:
        return None, str(e)

def read_word_file(uploaded_file):
    """Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Word ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©"""
    try:
        # Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¤Ù‚Øª
        with tempfile.NamedTemporaryFile(delete=False, suffix='.docx') as tmp_file:
            tmp_file.write(uploaded_file.getvalue())
            tmp_path = tmp_file.name
        
        # Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯
        doc = Document(tmp_path)
        
        # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ
        full_text = ""
        for para in doc.paragraphs:
            if para.text.strip():
                full_text += para.text + "\n"
        
        # ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¤Ù‚Øª
        os.unlink(tmp_path)
        
        return full_text, None
    except Exception as e:
        return None, str(e)

def detect_question_type(question_text):
    """ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„"""
    question_lower = question_text.lower()
    
    if any(word in question_lower for word in ['frequency', 'ØªÙƒØ±Ø§Ø±ÙŠ', 'Ø¬Ø¯ÙˆÙ„']):
        return 'FREQUENCY'
    elif any(word in question_lower for word in ['mean', 'median', 'average', 'Ù…ØªÙˆØ³Ø·', 'Ù…Ù‚Ø§ÙŠÙŠØ³']):
        return 'DESCRIPTIVE'
    elif any(word in question_lower for word in ['bar chart', 'Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø¹Ù…ÙˆØ¯ÙŠ']):
        return 'BAR_CHART'
    elif any(word in question_lower for word in ['pie chart', 'Ø±Ø³Ù… Ø¯Ø§Ø¦Ø±ÙŠ']):
        return 'PIE_CHART'
    elif any(word in question_lower for word in ['confidence', 'Ø«Ù‚Ø©', 'ÙØªØ±Ø©']):
        return 'CONFIDENCE'
    elif any(word in question_lower for word in ['hypothesis', 'Ø§Ø®ØªØ¨Ø§Ø±', 'ÙØ±Ø¶ÙŠØ©']):
        return 'T_TEST'
    elif any(word in question_lower for word in ['correlation', 'Ø§Ø±ØªØ¨Ø§Ø·']):
        return 'CORRELATION'
    else:
        return 'GENERAL'

def extract_variables(question_text, df_columns):
    """Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„"""
    found_vars = []
    question_lower = question_text.lower()
    
    for col in df_columns:
        col_lower = str(col).lower()
        
        # Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
        if col_lower in question_lower:
            found_vars.append(col)
        # Ø§Ù„Ø¨Ø­Ø« Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø¹Ø§Ù…Ø©
        elif 'salary' in question_lower and 'salary' in col_lower:
            found_vars.append(col)
        elif 'age' in question_lower and 'age' in col_lower:
            found_vars.append(col)
        elif 'gender' in question_lower and 'gender' in col_lower:
            found_vars.append(col)
    
    # Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù…ØªØºÙŠØ±Ø§ØªØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„ 3 Ø£Ø¹Ù…Ø¯Ø©
    if not found_vars and len(df_columns) > 0:
        found_vars = list(df_columns[:min(3, len(df_columns))])
    
    return found_vars

def generate_spss_syntax(df, questions_text):
    """ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ SPSS"""
    
    # Ø±Ø£Ø³ Ø§Ù„ÙƒÙˆØ¯
    syntax = "* SPSS Syntax Generated Automatically\n"
    syntax += "* Generated by SPSS Syntax Generator\n"
    syntax += f"* Number of variables: {len(df.columns)}\n"
    syntax += f"* Number of cases: {len(df)}\n\n"
    
    # Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    syntax += "* ===== DATA SETUP =====\n"
    syntax += "DATASET NAME DataSet1 WINDOW=FRONT.\n"
    syntax += "DATASET ACTIVATE DataSet1.\n\n"
    
    # ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
    syntax += "* Variable Labels\n"
    for i, col in enumerate(df.columns, 1):
        syntax += f'VARIABLE LABELS {col} "{col}".\n'
    
    syntax += "\n* Variable Types\n"
    for col in df.columns:
        # ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…ØªØºÙŠØ±
        if df[col].dtype in ['int64', 'float64']:
            if len(df[col].unique()) < 10:
                syntax += f'VARIABLE LEVEL {col} (NOMINAL).\n'
            else:
                syntax += f'VARIABLE LEVEL {col} (SCALE).\n'
        else:
            syntax += f'VARIABLE LEVEL {col} (NOMINAL).\n'
    
    syntax += "\nEXECUTE.\n"
    syntax += "*" * 60 + "\n\n"
    
    # ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    if questions_text:
        syntax += "* ===== QUESTION ANALYSIS =====\n\n"
        
        # ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø£Ø³Ø·Ø±
        lines = questions_text.split('\n')
        question_num = 1
        
        for line in lines:
            if line.strip() and len(line.strip()) > 10:  # Ø®Ø·ÙˆØ· ØºÙŠØ± ÙØ§Ø±ØºØ© ÙˆØ·ÙˆÙŠÙ„Ø© Ø¨Ù…Ø§ ÙŠÙƒÙÙŠ
                syntax += f"* Question {question_num}: {line[:80]}...\n"
                
                # ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„
                q_type = detect_question_type(line)
                
                # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
                variables = extract_variables(line, df.columns)
                
                # ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
                if q_type == 'FREQUENCY':
                    syntax += f"FREQUENCIES VARIABLES={' '.join(variables)}\n"
                    syntax += "  /BARCHART FREQ\n"
                    syntax += "  /ORDER=ANALYSIS.\n"
                
                elif q_type == 'DESCRIPTIVE':
                    syntax += f"DESCRIPTIVES VARIABLES={' '.join(variables)}\n"
                    syntax += "  /STATISTICS=MEAN STDDEV MIN MAX.\n"
                
                elif q_type == 'BAR_CHART':
                    if len(variables) >= 2:
                        syntax += f"GRAPH\n"
                        syntax += f"  /BAR(GROUPED)=MEAN({variables[1]}) BY {variables[0]}\n"
                        syntax += "  /TITLE='Bar Chart'.\n"
                    else:
                        syntax += f"GRAPH\n"
                        syntax += f"  /BAR(SIMPLE)=COUNT BY {variables[0]}\n"
                        syntax += "  /TITLE='Bar Chart'.\n"
                
                elif q_type == 'PIE_CHART':
                    syntax += f"GRAPH\n"
                    syntax += f"  /PIE=PCT BY {variables[0]}\n"
                    syntax += "  /TITLE='Pie Chart'.\n"
                
                elif q_type == 'T_TEST':
                    syntax += f"T-TEST\n"
                    syntax += f"  /TESTVAL=0\n"
                    syntax += f"  /VARIABLES={variables[0]}\n"
                    syntax += "  /CRITERIA=CI(.95).\n"
                
                elif q_type == 'CORRELATION':
                    if len(variables) >= 2:
                        syntax += f"CORRELATIONS\n"
                        syntax += f"  /VARIABLES={' '.join(variables[:2])}\n"
                        syntax += "  /PRINT=TWOTAIL NOSIG.\n"
                    else:
                        syntax += "* Need at least 2 variables for correlation\n"
                
                else:
                    # ÙƒÙˆØ¯ Ø¹Ø§Ù… Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹
                    syntax += f"DESCRIPTIVES VARIABLES={' '.join(variables)}\n"
                    syntax += "  /STATISTICS=MEAN STDDEV.\n"
                
                syntax += "EXECUTE.\n\n"
                question_num += 1
        
        # Ø¥Ø¶Ø§ÙØ© ØªØ­Ù„ÙŠÙ„Ø§Øª Ø¹Ø§Ù…Ø©
        syntax += "* ===== GENERAL ANALYSES =====\n\n"
        syntax += "* Descriptive Statistics for all variables\n"
        syntax += "DESCRIPTIVES VARIABLES=ALL\n"
        syntax += "  /STATISTICS=MEAN STDDEV MIN MAX.\n\n"
        
        syntax += "* Frequency tables for categorical variables\n"
        syntax += "FREQUENCIES VARIABLES=ALL\n"
        syntax += "  /BARCHART FREQ\n"
        syntax += "  /ORDER=ANALYSIS.\n"
    
    syntax += "\n* ===== END OF SYNTAX =====\n"
    syntax += "DATASET CLOSE ALL.\n"
    syntax += "EXECUTE.\n"
    
    return syntax

# ===== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… =====

# Ø´Ø±ÙŠØ· Ø¬Ø§Ù†Ø¨ÙŠ Ù„Ù„ØªØ­ÙƒÙ…
with st.sidebar:
    st.header("âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª")
    st.markdown("---")
    
    st.subheader("ğŸ“ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª")
    
    # Ø±ÙØ¹ Ù…Ù„Ù Excel
    excel_file = st.file_uploader(
        "Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Excel)",
        type=['xls', 'xlsx', 'csv'],
        help="Ø§Ø±ÙØ¹ Ù…Ù„Ù Excel ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ"
    )
    
    # Ø±ÙØ¹ Ù…Ù„Ù Word
    word_file = st.file_uploader(
        "Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Word)",
        type=['docx', 'doc', 'txt'],
        help="Ø§Ø±ÙØ¹ Ù…Ù„Ù Word ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©"
    )
    
    st.markdown("---")
    
    # Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ…
    generate_button = st.button(
        "ğŸš€ ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ SPSS",
        type="primary",
        use_container_width=True
    )

# Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
st.markdown("---")

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
if excel_file is None:
    st.info("ğŸ‘ˆ ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ù…Ù„Ù Excel Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ")
    
    # Ø¹Ø±Ø¶ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
    with st.expander("ğŸ“– ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…"):
        st.markdown("""
        ### Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
        1. **Ø±ÙØ¹ Ù…Ù„Ù Excel** Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ â† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
        2. **Ø±ÙØ¹ Ù…Ù„Ù Word** Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ â† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        3. **Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± 'ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ SPSS'**
        4. **ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØªÙˆÙ„Ø¯** ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ SPSS
        
        ### Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ù„ÙØ§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„:
        - **Ù…Ù„Ù Excel**: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:
          - Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
          - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ØªØ§Ù„ÙŠØ©
          - ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ØµÙŠØºØ© .xls Ø£Ùˆ .xlsx
        
        - **Ù…Ù„Ù Word**: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:
          - Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ØªØ­Ù„ÙŠÙ„Ù‡Ø§
          - ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ØµÙŠØºØ© .doc Ø£Ùˆ .docx
        """)
    
elif excel_file and generate_button:
    # Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
    progress_bar = st.progress(0)
    status_text = st.empty()
    
    status_text.text("ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel...")
    df, excel_error = read_excel_file(excel_file)
    progress_bar.progress(30)
    
    if excel_error:
        st.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Excel: {excel_error}")
    elif df is not None:
        status_text.text("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­")
        
        # Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        col1, col2, col3 = st.columns(3)
        with col1:
            st.metric("Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª", len(df.columns))
        with col2:
            st.metric("Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª", len(df))
        with col3:
            st.metric("Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©", f"{df.notna().mean().mean():.1%}")
        
        # Ø¹Ø±Ø¶ Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        with st.expander("ğŸ” Ø¹Ø±Ø¶ Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"):
            st.dataframe(df.head())
        
        # Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
        with st.expander("ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª"):
            for i, col in enumerate(df.columns, 1):
                st.write(f"{i}. **{col}** - Ø§Ù„Ù†ÙˆØ¹: {df[col].dtype}")
        
        # Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Word Ø¥Ø°Ø§ ØªÙ… Ø±ÙØ¹Ù‡
        if word_file:
            status_text.text("ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Word...")
            questions_text, word_error = read_word_file(word_file)
            progress_bar.progress(70)
            
            if word_error:
                st.warning(f"âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ø­ÙˆÙ„ Ù…Ù„Ù Word: {word_error}")
                questions_text = None
            else:
                status_text.text("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Word Ø¨Ù†Ø¬Ø§Ø­")
                
                # Ø¹Ø±Ø¶ Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                if questions_text and len(questions_text) > 0:
                    with st.expander("ğŸ“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©"):
                        lines = questions_text.split('\n')
                        for i, line in enumerate(lines[:10]):
                            if line.strip():
                                q_type = detect_question_type(line)
                                st.write(f"**Ø§Ù„Ø³Ø·Ø± {i+1}**: {line[:100]}...")
                                st.caption(f"Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„: {q_type}")
                else:
                    st.warning("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ù…Ù„Ù Word")
                    questions_text = None
        else:
            questions_text = None
            st.info("â„¹ï¸ Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ù…Ù„Ù Word - Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¹Ø§Ù… ÙÙ‚Ø·")
        
        # ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ SPSS
        status_text.text("ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ SPSS...")
        spss_syntax = generate_spss_syntax(df, questions_text)
        progress_bar.progress(100)
        status_text.text("âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ SPSS Ø¨Ù†Ø¬Ø§Ø­!")
        
        # Ø¹Ø±Ø¶ ÙƒÙˆØ¯ SPSS
        st.markdown("---")
        st.subheader("ğŸ“œ ÙƒÙˆØ¯ SPSS Ø§Ù„Ù…ØªÙˆÙ„Ø¯")
        
        # Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù†Øµ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯
        st.code(spss_syntax, language='spss')
        
        # Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        st.download_button(
            label="ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù SPSS (.sps)",
            data=spss_syntax,
            file_name="spss_syntax.sps",
            mime="text/plain",
            use_container_width=True
        )
        
        # ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
        with st.expander("ğŸ’¡ ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ SPSS"):
            st.markdown("""
            1. **Ø§ÙØªØ­ Ø¨Ø±Ù†Ø§Ù…Ø¬ SPSS**
            2. **Ø§ÙØªØ­ Ù…Ù„Ù Ø¨ÙŠØ§Ù†Ø§ØªÙƒ** Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            3. **Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰:**
               - `File` â†’ `New` â†’ `Syntax`
            4. **Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØªÙˆÙ„Ø¯** ÙˆØ§Ù„ØµÙ‚Ù‡ ÙÙŠ Ù†Ø§ÙØ°Ø© Syntax
            5. **Ø´ØºÙ„ Ø§Ù„ÙƒÙˆØ¯** Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰:
               - `Run` â†’ `All`
            6. **ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬** ÙÙŠ Ù†Ø§ÙØ°Ø© Output
            
            ### Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©:
            - ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ØªØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯
            - ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ
            - Ø§Ø­ÙØ¸ Ù…Ù„Ù Syntax Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ
            """)
        
        # Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¡Ø§Øª
        with st.expander("ğŸ“Š Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø¹Ø§Ù…Ø©"):
            st.write("**Ù…Ù„Ø®Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:**")
            st.write(df.describe())
            
            # Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            data_types = df.dtypes.value_counts()
            st.write("**Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:**")
            for dtype, count in data_types.items():
                st.write(f"- {dtype}: {count} Ù…ØªØºÙŠØ±")
    
    else:
        st.error("âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù Excel")

elif excel_file and not generate_button:
    st.info("ğŸ‘ˆ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± 'ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ SPSS' ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆÙ„ÙŠØ¯")

# ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
st.markdown("---")
st.markdown(
    """
    <div style='text-align: center; color: gray;'>
    <p>Ù…ÙˆÙ„Ø¯ ÙƒÙˆØ¯ SPSS Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ | ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª 26+ | ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</p>
    </div>
    """,
    unsafe_allow_html=True
)
